<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Metal Performance Shaders for the iPad playground</title>
  <meta name="description" content="As many of you might have seen at WWDC 2016, the new Playground app for the iPad was a really big hit! As an already playgrounds lover, for me it was even mo...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="shortcut icon" href="https://devimages.apple.com.edgekey.net/assets/elements/icons/metal/metal-128x128_2x.png" />
  <link rel="canonical" href="http://localhost:4000/2016/07/31/metal-performance-shaders-for-the-ipad-playground.html">
  <link rel="alternate" type="application/rss+xml" title="The Metal Framework" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">The Metal Framework</a>

    <nav class="site-nav">
      <a href="/archive.html" style="color:grey;">Archives</a>&nbsp;&nbsp;&nbsp;
      <a href="/contact.html" style="color:grey;">Contact</a>&nbsp;&nbsp;&nbsp;
      <a href="/feed.xml" style="color:grey;">RSS</a>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Metal Performance Shaders for the iPad playground</h1>
    <p class="post-meta"><time datetime="2016-07-31T00:00:00+03:00" itemprop="datePublished">Jul 31, 2016</time></p>
  </header>

  <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_reddit"></a>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_linkedin"></a>
    <a class="a2a_button_email"></a>
  </div>
  <script async src="https://static.addtoany.com/menu/page.js"></script><br /><br />

  <div class="post-content" itemprop="articleBody">
    <p>As many of you might have seen at <code class="highlighter-rouge">WWDC 2016</code>, the new <a href="https://developer.apple.com/videos/play/wwdc2016/408/">Playground app for the iPad</a> was a really big hit! As an already playgrounds lover, for me it was even more than that. Now we are able to easily write <code class="highlighter-rouge">Swift</code> code on the iPad and run it with just a button tap. Today we are going to have fun with <strong>Metal Performance Shaders (MPS)</strong> since I have not discussed about them before, and also because it is so easy to use them on mobile devices. This reminds me to warn you, the <code class="highlighter-rouge">MPS</code> framework only works on <code class="highlighter-rouge">iOS</code> and <code class="highlighter-rouge">tvOS</code> devices. We will look into a handy way of writing the playground on a <code class="highlighter-rouge">macOS</code> device and then sharing it with your mobile device through the <code class="highlighter-rouge">iCloud Drive</code>. Also, the <code class="highlighter-rouge">iPad</code> playgrounds are working only on <code class="highlighter-rouge">iOS 10</code> or newer.</p>

<p>To start, let’s create a new <code class="highlighter-rouge">iOS</code> playground in <code class="highlighter-rouge">Xcode</code>. You can add any image you like under the <code class="highlighter-rouge">Resources</code> folder. I already added one named <strong>nature.jpg</strong>. Next, write a few lines of code in the main playground page, like in this screenshot (the code is available on Github):</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_1.png" alt="alt text" title="1" /></p>

<p>Let’s go over the code. We have been writing most of this code over and over in the previous blog posts. The first new addition you will notice immediately is also generating an error, and that is because <code class="highlighter-rouge">macOS</code> does not “know” about the <code class="highlighter-rouge">MPS</code> framework. Once we load this playground on an iPad, the error will go away:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">MetalPerformanceShaders</span></code></pre></figure>

<p>Next, we use <code class="highlighter-rouge">MTKTextureLoader</code> to create a new texture from the image we added above. Now comes the really interesting part! Once we created our <code class="highlighter-rouge">MTLCommandBuffer</code> object, we are not going to create a <code class="highlighter-rouge">MTLCommandEncoder</code> object too from this command buffer as we were used to do. Rather, we create a new <code class="highlighter-rouge">MPSImageGaussianBlur</code> object as in the code below:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">shader</span> <span class="o">=</span> <span class="kt">MPSImageGaussianBlur</span><span class="p">(</span><span class="nv">device</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">device</span><span class="o">!</span><span class="p">,</span> <span class="nv">sigma</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">shader</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="nv">commandBuffer</span><span class="p">:</span> <span class="n">commandBuffer</span><span class="p">,</span> <span class="nv">sourceTexture</span><span class="p">:</span> <span class="n">texIn</span><span class="p">,</span> <span class="nv">destinationTexture</span><span class="p">:</span> <span class="n">texOut</span><span class="p">)</span></code></pre></figure>

<p>What’s great about the <code class="highlighter-rouge">MPS</code> objects is that they let you apply a compute shader (kernel function) to an input texture without us even having to configure any states, descriptors, pipelines or even write a kernel function, ever! The <code class="highlighter-rouge">MPS</code> object takes care of everything for us. Of course, by taking this approach we are somewhat limited to only picking a preset shader and possibly changing a parameter such as <strong>sigma</strong>, for this particular shader.</p>

<p>So far so good! We are now ready to send our playground to the <code class="highlighter-rouge">iPad</code> through the <code class="highlighter-rouge">iCloud Drive</code>. Open a <code class="highlighter-rouge">Finder</code> window, click on <code class="highlighter-rouge">iCloud Drive</code> and copy your playground into this folder:</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_8.PNG" alt="alt text" title="2" /></p>

<p>We are finally getting to use the <code class="highlighter-rouge">iPad</code>! Open the new <code class="highlighter-rouge">Playgrounds</code> app that you downloaded from the <code class="highlighter-rouge">App Store</code> and go to <code class="highlighter-rouge">My Playgrounds</code>. In the top left corner of the screen, tap on the <strong>+</strong> button. As you can see you can also create a new playground on the <code class="highlighter-rouge">iPad</code> and then easily export it to your <code class="highlighter-rouge">macOS</code> devices or share it using various other tools. For now, however, we are going to tap on <code class="highlighter-rouge">iCloud Drive</code> as seen below:</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_2.PNG" alt="alt text" title="2" /></p>

<p>When the <code class="highlighter-rouge">iCloud Drive</code> window pops up, notice that we have access to the <code class="highlighter-rouge">iPad</code>’s private folder for playgrounds as well, however, we now want to import the one we were working on, <strong>MPS.playground</strong>, so tap on it:</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_3.PNG" alt="alt text" title="3" /></p>

<p>As soon as the <code class="highlighter-rouge">iPad</code> loaded the playground, we’re in business! You can see the main playground page now on your <code class="highlighter-rouge">iPad</code>:</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_4.PNG" alt="alt text" title="4" /></p>

<p>All you have to do now is tap on <code class="highlighter-rouge">Run My Code</code> and see our image with a nice blur filter applied to it:</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_5.PNG" alt="alt text" title="5" /></p>

<p>“Ok,” you might say, “but how do we see the entire image?” The answer is in the animated GIF below. It’s as easy as long pressing in the middle of the screen until a screen separating line shows. With the finger still on the screen, drag the line to either the left side or the right side, depending on what do you need to see, your code or your output image (you might want to reload the page as the animated GIF may only run once before it stops):</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_6.gif" alt="alt text" title="6" /></p>

<p>Now you can see that blurred image entirely! And when you’re done admiring the image, tap that handy button on the left side (and midway vertically) of the screen to go back to split screen. Before we wrap it up, one more piece of awesomeness. Replace the line below:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">shader</span> <span class="o">=</span> <span class="kt">MPSImageGaussianBlur</span><span class="p">(</span><span class="nv">device</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">device</span><span class="o">!</span><span class="p">,</span> <span class="nv">sigma</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span></code></pre></figure>

<p>with this line:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">shader</span> <span class="o">=</span> <span class="kt">MPSImageSobel</span><span class="p">(</span><span class="nv">device</span><span class="p">:</span> <span class="n">device</span><span class="p">)</span></code></pre></figure>

<p>Check out the new output image:</p>

<p><img src="https://github.com/MetalKit/images/raw/master/mps_7.PNG" alt="alt text" title="7" /></p>

<p>Imagine the possibilities you have here by only changing one line of code! There are a couple dozen different shaders that you can try. Check out the <a href="https://developer.apple.com/reference/metalperformanceshaders#symbols">Metal Performance Shaders API</a> for more details. If you are interested in image processing, you might want to also check Simon Gladman’s <a href="https://itunes.apple.com/us/book/core-image-for-swift/id1073029980?mt=13">Core Image for Swift</a> book. If you want to learn more about the <code class="highlighter-rouge">Metal</code> backend of <code class="highlighter-rouge">MPS</code>, also check out Warren Moore’s <a href="https://gum.co/metalbyexample">Metal by Example</a> book. The <a href="https://github.com/MetalKit/mps">source code</a> for the playground in this article is posted on Github as usual.</p>

<p>Until next time!</p>

  </div>

  <!-- 
    

   -->

  <div class="a2a_kit a2a_kit_size_32 a2a_default_style"><br />
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_reddit"></a>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_linkedin"></a>
    <a class="a2a_button_email"></a>
  </div>
  <script async src="https://static.addtoany.com/menu/page.js"></script>
</article>
      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper" align="center">

    <!-- <p class="rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></p> -->

    <!-- Begin MailChimp Signup Form --><p>
    <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
    <style type="text/css">
      #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    </style>
    <div id="mc_embed_signup">
      <form action="//github.us12.list-manage.com/subscribe/post?u=5daab344aba23020915a23c29&amp;id=69e4a7c3af" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
          <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Subscribe to be notified of new posts.</label>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_5daab344aba23020915a23c29_69e4a7c3af" tabindex="-1" value=""></div>
          <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
          </div>
      </form>
    </div>
    </p><!--End mc_embed_signup-->

    <!-- <h2 class="footer-heading">The Metal Framework</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <p class="rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></p>
        <ul class="contact-list">
          <li>
            
              The Metal Framework
            
            </li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/MetalKit"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">MetalKit</span></a>

          </li>
          
          
          <li>
            <a href="https://twitter.com/MTLDevice"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">MTLDevice</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        
          <a href="https://twitter.com/MTLDevice"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">MTLDevice</span></a>

        
        <p>Resources and tutorials for Metal, MetalKit and Metal Performance Shaders.
</p>
      </div>
    </div> -->

  </div>

</footer>


  </body>

</html>
